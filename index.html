<!doctype html>
<html lang="ar" dir="rtl" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NOUR NADY - Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø´Ø±Ù</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- ØªÙ…Øª Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù€ SDK Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© ÙˆØ§Ø³ØªØ¨Ø¯Ø§Ù„Ù‡Ø§ Ø¨Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ù…Ø¨Ø§Ø´Ø± ÙÙŠ Ø§Ù„Ø£Ø³ÙÙ„ -->
  <script src="/_sdk/element_sdk.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&amp;display=swap" rel="stylesheet">
  <style>
    body { box-sizing: border-box; }
    * { font-family: 'Cairo', sans-serif; }
    .gradient-bg { background: linear-gradient(135deg, #0f2027 0%, #203a43 50%, #2c5364 100%); }
    .card-glass { background: rgba(255,255,255,0.05); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.1); }
    .btn-primary { background: linear-gradient(135deg, #00d4ff 0%, #0099ff 100%); }
    .btn-primary:hover { background: linear-gradient(135deg, #0099ff 0%, #00d4ff 100%); }
    .btn-secondary { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
    .btn-secondary:hover { background: linear-gradient(135deg, #764ba2 0%, #667eea 100%); }
    .btn-danger { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
    .btn-danger:hover { background: linear-gradient(135deg, #f5576c 0%, #f093fb 100%); }
    .input-style { background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); }
    .input-style:focus { border-color: #00d4ff; outline: none; }
    .stat-card { background: linear-gradient(135deg, rgba(0,212,255,0.1), rgba(0,153,255,0.1)); border: 1px solid rgba(0,212,255,0.3); }
    .stat-number { color: #00d4ff; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    .animate-fade { animation: fadeIn 0.5s ease-out; }
  </style>
  <style>@view-transition { navigation: auto; }</style>
 </head>
 <body class="h-full gradient-bg text-white overflow-auto">
  <div id="app" class="min-h-full w-full"><!-- Loading Screen -->
   <div id="loading-screen" class="fixed inset-0 gradient-bg flex items-center justify-center z-50">
    <div class="text-center">
     <div class="w-16 h-16 border-4 border-t-cyan-400 border-r-transparent border-b-cyan-400 border-l-transparent rounded-full animate-spin mx-auto mb-4"></div>
     <p class="text-xl">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</p>
    </div>
   </div><!-- Login Page -->
   <div id="login-page" class="hidden min-h-full w-full p-4">
    <div class="max-w-md mx-auto pt-20 animate-fade">
     <div class="text-center mb-8">
      <h1 class="text-4xl font-black text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-blue-500 mb-2">NOUR NADY</h1>
      <p class="text-gray-400">Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø´Ø±Ù</p>
     </div>
     <div class="card-glass rounded-2xl p-8">
      <form id="admin-login-form" onsubmit="handleAdminLogin(event)">
       <div class="mb-4"><label class="block mb-2 text-gray-300">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label> <input type="email" id="admin-email-input" class="w-full p-4 rounded-xl input-style text-white" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" required>
       </div>
       <div class="mb-6"><label class="block mb-2 text-gray-300">ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±</label> <input type="password" id="admin-password-input" class="w-full p-4 rounded-xl input-style text-white" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" required>
       </div><button type="submit" id="login-btn" class="w-full py-4 rounded-xl btn-primary text-white font-bold text-lg">Ø¯Ø®ÙˆÙ„</button>
       <p id="login-error" class="text-red-400 text-center mt-4 hidden"></p>
      </form>
     </div>
     <div class="mt-8 p-4 card-glass rounded-xl text-center text-sm text-gray-400">
      <p>Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø´Ø±Ù Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©:</p>
      <p>Ø§Ù„Ø¨Ø±ÙŠØ¯: noornady00@gmail.com</p>
      <p>ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±: noornady2007</p>
     </div>
    </div>
   </div><!-- Dashboard -->
   <div id="dashboard" class="hidden min-h-full w-full"><!-- Header -->
    <header class="card-glass p-4 sticky top-0 z-40 shadow-lg">
     <div class="max-w-7xl mx-auto flex justify-between items-center">
      <h1 class="text-2xl font-black text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-blue-500">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h1><button onclick="logoutAdmin()" class="bg-red-500/20 text-red-400 px-4 py-2 rounded-xl hover:bg-red-500/30 font-bold">Ø®Ø±ÙˆØ¬</button>
     </div>
    </header><!-- Navigation Tabs -->
    <nav class="max-w-7xl mx-auto p-4">
     <div class="flex gap-2 flex-wrap"><button onclick="showAdminSection('overview')" class="admin-nav-btn active px-6 py-3 rounded-xl btn-primary text-white font-bold whitespace-nowrap" data-section="overview">ğŸ“Š Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©</button> <button onclick="showAdminSection('courses')" class="admin-nav-btn px-6 py-3 rounded-xl card-glass text-gray-300 font-bold whitespace-nowrap" data-section="courses">ğŸ“š Ø§Ù„ÙƒÙˆØ±Ø³Ø§Øª</button> <button onclick="showAdminSection('exams')" class="admin-nav-btn px-6 py-3 rounded-xl card-glass text-gray-300 font-bold whitespace-nowrap" data-section="exams">ğŸ“ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª</button> <button onclick="showAdminSection('students')" class="admin-nav-btn px-6 py-3 rounded-xl card-glass text-gray-300 font-bold whitespace-nowrap" data-section="students">ğŸ‘¥ Ø§Ù„Ø·Ù„Ø§Ø¨</button> <button onclick="showAdminSection('analytics')" class="admin-nav-btn px-6 py-3 rounded-xl card-glass text-gray-300 font-bold whitespace-nowrap" data-section="analytics">ğŸ“ˆ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</button>
     </div>
    </nav><!-- Content Area -->
    <main class="max-w-7xl mx-auto p-4"><!-- Overview Section -->
     <section id="overview-section" class="animate-fade">
      <h2 class="text-2xl font-bold mb-6">ğŸ“Š Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©</h2>
      <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
       <div class="stat-card rounded-xl p-6 text-center">
        <p class="text-gray-400 mb-2">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø§Ø¨</p>
        <p class="stat-number text-4xl font-black" id="total-students">0</p>
       </div>
       <div class="stat-card rounded-xl p-6 text-center">
        <p class="text-gray-400 mb-2">Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ù…ÙØ¹ØªÙ…Ø¯ÙŠÙ†</p>
        <p class="stat-number text-4xl font-black" id="approved-students">0</p>
       </div>
       <div class="stat-card rounded-xl p-6 text-center">
        <p class="text-gray-400 mb-2">Ø¹Ø¯Ø¯ Ø§Ù„ÙƒÙˆØ±Ø³Ø§Øª</p>
        <p class="stat-number text-4xl font-black" id="total-courses">0</p>
       </div>
       <div class="stat-card rounded-xl p-6 text-center">
        <p class="text-gray-400 mb-2">Ø¹Ø¯Ø¯ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª</p>
        <p class="stat-number text-4xl font-black" id="total-exams">0</p>
       </div>
      </div>
     </section><!-- Courses Section -->
     <section id="courses-section" class="hidden animate-fade">
      <div class="flex justify-between items-center mb-6">
       <h2 class="text-2xl font-bold">ğŸ“š Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙƒÙˆØ±Ø³Ø§Øª</h2><button onclick="openAddCourseModal()" class="btn-secondary px-6 py-3 rounded-xl text-white font-bold">+ Ø¥Ø¶Ø§ÙØ© ÙƒÙˆØ±Ø³ Ø¬Ø¯ÙŠØ¯</button>
      </div>
      <div id="courses-list" class="space-y-4">
       <p class="text-gray-400 text-center py-10">Ù„Ø§ ØªÙˆØ¬Ø¯ ÙƒÙˆØ±Ø³Ø§Øª</p>
      </div>
     </section><!-- Exams Section -->
     <section id="exams-section" class="hidden animate-fade">
      <div class="flex justify-between items-center mb-6">
       <h2 class="text-2xl font-bold">ğŸ“ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª</h2><button onclick="openAddExamModal()" class="btn-secondary px-6 py-3 rounded-xl text-white font-bold">+ Ø¥Ø¶Ø§ÙØ© Ø§Ù…ØªØ­Ø§Ù† Ø¬Ø¯ÙŠØ¯</button>
      </div>
      <div id="exams-list" class="space-y-4">
       <p class="text-gray-400 text-center py-10">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø§Ù…ØªØ­Ø§Ù†Ø§Øª</p>
      </div>
     </section><!-- Students Section -->
     <section id="students-section" class="hidden animate-fade">
      <h2 class="text-2xl font-bold mb-6">ğŸ‘¥ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø§Ø¨</h2>
      <div class="space-y-4">
       <div class="mb-6">
        <h3 class="text-xl font-bold text-cyan-400 mb-4">â³ Ø·Ù„Ø¨Ø§Øª Ø§Ù„ØªØ³Ø¬ÙŠÙ„</h3>
        <div id="pending-students-list" class="space-y-3">
         <p class="text-gray-400 text-center py-6">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ù…Ø¹Ù„Ù‚Ø©</p>
        </div>
       </div>
       <div>
        <h3 class="text-xl font-bold text-green-400 mb-4">âœ… Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ù…ÙØ¹ØªÙ…Ø¯ÙŠÙ†</h3>
        <div id="approved-students-list" class="space-y-3">
         <p class="text-gray-400 text-center py-6">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø§Ø¨ Ù…ÙØ¹ØªÙ…Ø¯ÙŠÙ†</p>
        </div>
       </div>
      </div>
     </section><!-- Analytics Section -->
     <section id="analytics-section" class="hidden animate-fade">
      <h2 class="text-2xl font-bold mb-6">ğŸ“ˆ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…ÙØµÙ„Ø©</h2>
      <div class="space-y-6">
       <div class="card-glass rounded-2xl p-6">
        <h3 class="text-xl font-bold mb-4">ğŸ‘ï¸ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø©</h3>
        <div id="watch-stats" class="space-y-3">
         <p class="text-gray-400 text-center py-6">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø´Ø§Ù‡Ø¯Ø©</p>
        </div>
       </div>
       <div class="card-glass rounded-2xl p-6">
        <h3 class="text-xl font-bold mb-4">ğŸ“Š Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª</h3>
        <div id="exam-stats" class="space-y-3">
         <p class="text-gray-400 text-center py-6">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ø§Ù…ØªØ­Ø§Ù†Ø§Øª</p>
        </div>
       </div>
      </div>
     </section>
    </main>
   </div><!-- Add Course Modal -->
   <div id="add-course-modal" class="hidden fixed inset-0 bg-black/90 z-50 overflow-auto p-4">
    <div class="max-w-2xl mx-auto my-8">
     <div class="card-glass rounded-2xl p-6">
      <div class="flex justify-between items-center mb-6">
       <h3 class="text-2xl font-bold">Ø¥Ø¶Ø§ÙØ© ÙƒÙˆØ±Ø³ Ø¬Ø¯ÙŠØ¯</h3><button onclick="closeAddCourseModal()" class="text-white text-3xl">Ã—</button>
      </div>
      <form id="add-course-form" onsubmit="handleAddCourse(event)">
       <div class="mb-4"><label class="block mb-2 text-gray-300">Ø§Ø³Ù… Ø§Ù„ÙƒÙˆØ±Ø³</label> <input type="text" id="course-name-input" class="w-full p-3 rounded-lg input-style text-white" placeholder="Ù…Ø«Ø§Ù„: Ø±ÙŠØ§Ø¶ÙŠØ§Øª" required>
       </div>
       <div class="mb-4"><label class="block mb-2 text-gray-300">Ø§Ù„ØµÙ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ</label> <select id="course-grade-input" class="w-full p-3 rounded-lg input-style text-white" required> <option value="">Ø§Ø®ØªØ± Ø§Ù„ØµÙ</option> <option value="prep1">Ø£ÙˆÙ„Ù‰ Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ</option> <option value="prep2">ØªØ§Ù†ÙŠØ© Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ</option> <option value="prep3">ØªØ§Ù„ØªØ© Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ</option> <option value="sec1">Ø£ÙˆÙ„Ù‰ Ø«Ø§Ù†ÙˆÙŠ</option> <option value="sec2">ØªØ§Ù†ÙŠØ© Ø«Ø§Ù†ÙˆÙŠ</option> <option value="sec3">ØªØ§Ù„ØªØ© Ø«Ø§Ù†ÙˆÙŠ</option> </select>
       </div>
       <div class="mb-6"><label class="block mb-2 text-gray-300">Ø±Ø§Ø¨Ø· Ø§Ù„ÙÙŠØ¯ÙŠÙˆ (YouTube Ø£Ùˆ Ø±Ø§Ø¨Ø· Ù…Ø¨Ø§Ø´Ø±)</label> <input type="url" id="video-url-input" class="w-full p-3 rounded-lg input-style text-white" placeholder="https://..." required>
       </div><button type="submit" id="add-course-btn" class="w-full py-3 rounded-lg btn-primary text-white font-bold">Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙƒÙˆØ±Ø³</button>
      </form>
     </div>
    </div>
   </div><!-- Add Exam Modal -->
   <div id="add-exam-modal" class="hidden fixed inset-0 bg-black/90 z-50 overflow-auto p-4">
    <div class="max-w-2xl mx-auto my-8">
     <div class="card-glass rounded-2xl p-6">
      <div class="flex justify-between items-center mb-6">
       <h3 class="text-2xl font-bold">Ø¥Ø¶Ø§ÙØ© Ø§Ù…ØªØ­Ø§Ù† Ø¬Ø¯ÙŠØ¯</h3><button onclick="closeAddExamModal()" class="text-white text-3xl">Ã—</button>
      </div>
      <form id="add-exam-form" onsubmit="handleAddExam(event)">
       <div class="mb-4"><label class="block mb-2 text-gray-300">Ø§Ø³Ù… Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†</label> <input type="text" id="exam-name-input" class="w-full p-3 rounded-lg input-style text-white" placeholder="Ù…Ø«Ø§Ù„: Ø§Ù…ØªØ­Ø§Ù† Ø§Ù„ÙˆØ­Ø¯Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰" required>
       </div>
       <div class="mb-4"><label class="block mb-2 text-gray-300">Ø§Ù„ØµÙ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ</label> <select id="exam-grade-input" class="w-full p-3 rounded-lg input-style text-white" required> <option value="">Ø§Ø®ØªØ± Ø§Ù„ØµÙ</option> <option value="prep1">Ø£ÙˆÙ„Ù‰ Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ</option> <option value="prep2">ØªØ§Ù†ÙŠØ© Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ</option> <option value="prep3">ØªØ§Ù„ØªØ© Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ</option> <option value="sec1">Ø£ÙˆÙ„Ù‰ Ø«Ø§Ù†ÙˆÙŠ</option> <option value="sec2">ØªØ§Ù†ÙŠØ© Ø«Ø§Ù†ÙˆÙŠ</option> <option value="sec3">ØªØ§Ù„ØªØ© Ø«Ø§Ù†ÙˆÙŠ</option> </select>
       </div>
       <div id="exam-questions" class="space-y-6 mb-6 max-h-96 overflow-y-auto">
        <div class="question-item p-4 card-glass rounded-lg">
         <div class="mb-3"><label class="block mb-2 text-gray-300">Ø§Ù„Ø³Ø¤Ø§Ù„ 1</label> <input type="text" class="w-full p-3 rounded-lg input-style text-white question-text" placeholder="Ù†Øµ Ø§Ù„Ø³Ø¤Ø§Ù„" required>
         </div>
         <div class="mb-3"><label class="block mb-2 text-gray-300">Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª (Ù…ÙØµÙˆÙ„Ø© Ø¨ÙØ§ØµÙ„Ø©)</label> <input type="text" class="w-full p-3 rounded-lg input-style text-white question-options" placeholder="Ø®ÙŠØ§Ø± 1, Ø®ÙŠØ§Ø± 2, Ø®ÙŠØ§Ø± 3, Ø®ÙŠØ§Ø± 4" required>
         </div>
         <div class="mb-3"><label class="block mb-2 text-gray-300">Ø±Ù‚Ù… Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø© (0-3)</label> <input type="number" class="w-full p-3 rounded-lg input-style text-white question-correct" min="0" max="3" placeholder="0" required>
         </div>
        </div>
       </div><button type="button" onclick="addExamQuestion()" class="w-full py-2 mb-4 rounded-lg btn-secondary text-white font-bold">+ Ø¥Ø¶Ø§ÙØ© Ø³Ø¤Ø§Ù„</button> <button type="submit" id="add-exam-btn" class="w-full py-3 rounded-lg btn-primary text-white font-bold">Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†</button>
      </form>
     </div>
    </div>
   </div><!-- Edit Course Modal -->
   <div id="edit-course-modal" class="hidden fixed inset-0 bg-black/90 z-50 overflow-auto p-4">
    <div class="max-w-2xl mx-auto my-8">
     <div class="card-glass rounded-2xl p-6">
      <div class="flex justify-between items-center mb-6">
       <h3 class="text-2xl font-bold">ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ÙƒÙˆØ±Ø³</h3><button onclick="closeEditCourseModal()" class="text-white text-3xl">Ã—</button>
      </div>
      <form id="edit-course-form" onsubmit="handleEditCourse(event)">
       <div class="mb-4"><label class="block mb-2 text-gray-300">Ø§Ø³Ù… Ø§Ù„ÙƒÙˆØ±Ø³</label> <input type="text" id="edit-course-name" class="w-full p-3 rounded-lg input-style text-white" required>
       </div>
       <div class="mb-4"><label class="block mb-2 text-gray-300">Ø§Ù„ØµÙ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ</label> <select id="edit-course-grade" class="w-full p-3 rounded-lg input-style text-white" required> <option value="prep1">Ø£ÙˆÙ„Ù‰ Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ</option> <option value="prep2">ØªØ§Ù†ÙŠØ© Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ</option> <option value="prep3">ØªØ§Ù„ØªØ© Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ</option> <option value="sec1">Ø£ÙˆÙ„Ù‰ Ø«Ø§Ù†ÙˆÙŠ</option> <option value="sec2">ØªØ§Ù†ÙŠØ© Ø«Ø§Ù†ÙˆÙŠ</option> <option value="sec3">ØªØ§Ù„ØªØ© Ø«Ø§Ù†ÙˆÙŠ</option> </select>
       </div>
       <div class="mb-6"><label class="block mb-2 text-gray-300">Ø±Ø§Ø¨Ø· Ø§Ù„ÙÙŠØ¯ÙŠÙˆ</label> <input type="url" id="edit-video-url" class="w-full p-3 rounded-lg input-style text-white" required>
       </div><button type="submit" id="edit-course-btn" class="w-full py-3 rounded-lg btn-primary text-white font-bold">Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª</button>
      </form>
     </div>
    </div>
   </div>
  </div>
  
  <script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getFirestore, collection, addDoc, updateDoc, deleteDoc, doc, onSnapshot, query, where } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
  import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
  
  const firebaseConfig = {
    apiKey: "AIzaSyDd1Z6tf88zho4j6gcf53TQz3yJmoQDpn8",
    authDomain: "noor5-be881.firebaseapp.com",
    projectId: "noor5-be881",
    storageBucket: "noor5-be881.firebasestorage.app",
    messagingSenderId: "310125450546",
    appId: "1:310125450546:web:ff3cb7005f28a204f3732b",
    measurementId: "G-RPQ7MNCS28"
  };
  
  // ØªÙ‡ÙŠØ¦Ø© Firebase
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const auth = getAuth(app);
  
  // ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ù…Ø¬Ù‡ÙˆÙ„ Ù„Ø¶Ù…Ø§Ù† Ø¹Ù…Ù„ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
  signInAnonymously(auth).then(() => {
    console.log("Connected to Firebase Auth");
  }).catch((error) => {
    console.error("Auth Error", error);
  });
  
  // Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø§Ù„Ù€ SDK Ø§Ù„Ù‚Ø¯ÙŠÙ… Ø¨Ù€ Firebase
  window.dataSdk = {
    async init(handler) {
      const q = query(collection(db, "platform_data"));
      onSnapshot(q, (snapshot) => {
        const data = snapshot.docs.map(doc => ({
          __backendId: doc.id,
          ...doc.data()
        }));
        handler.onDataChanged(data);
      });
      return { isOk: true };
    },
    async create(data) {
      try {
        await addDoc(collection(db, "platform_data"), data);
        return { isOk: true };
      } catch (e) { 
        console.error("Create Error", e);
        return { isOk: false }; 
      }
    },
    async update(data) {
      try {
        const id = data.__backendId;
        const ref = doc(db, "platform_data", id);
        const updateData = { ...data };
        delete updateData.__backendId;
        await updateDoc(ref, updateData);
        return { isOk: true };
      } catch (e) { return { isOk: false }; }
    },
    async delete(data) {
      try {
        await deleteDoc(doc(db, "platform_data", data.__backendId));
        return { isOk: true };
      } catch (e) { return { isOk: false }; }
    }
  };

  // Ø¨Ø¯Ø¡ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ÙÙ‚Ø· Ø¨Ø¹Ø¯ ØªÙ‡ÙŠØ¦Ø© Firebase
  if (window.initAdminApp) {
    window.initAdminApp();
  }
</script>
  
  <script>
    /* DATABASE_STORAGE - Ø¬Ù…ÙŠØ¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø´Ø±Ù ÙˆØ§Ù„ÙƒÙˆØ±Ø³Ø§Øª ÙˆØ§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª ØªÙØ­ÙØ¸ Ù‡Ù†Ø§ ÙÙŠ Canva Sheet */
    /* ÙŠÙ…ÙƒÙ†Ùƒ ØªØºÙŠÙŠØ± Ø§Ø³Ù… Ù‡Ø°Ø§ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚ Ø£Ùˆ Ù…ÙƒØ§Ù† Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ø§Ø­Ù‚Ø§Ù‹ */
    

    // Configuration
    const defaultConfig = {
      admin_email: 'noornady00@gmail.com',
      admin_password: 'noornady2007'
    };

    // Grade Labels
    const gradeLabels = {
      'prep1': 'Ø£ÙˆÙ„Ù‰ Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ',
      'prep2': 'ØªØ§Ù†ÙŠØ© Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ',
      'prep3': 'ØªØ§Ù„ØªØ© Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ',
      'sec1': 'Ø£ÙˆÙ„Ù‰ Ø«Ø§Ù†ÙˆÙŠ',
      'sec2': 'ØªØ§Ù†ÙŠØ© Ø«Ø§Ù†ÙˆÙŠ',
      'sec3': 'ØªØ§Ù„ØªØ© Ø«Ø§Ù†ÙˆÙŠ'
    };

    // App State
    let isAdminLoggedIn = false;
    let allData = [];
    let currentEditingCourse = null;

    // Data Handler
    const dataHandler = {
      onDataChanged(data) {
        /* DATABASE_STORAGE - Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªÙ„Ù…Ø© Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª */
        allData = data;
        console.log('Data updated:', data.length, 'records');
        
        if (isAdminLoggedIn) {
          updateOverviewStats();
          renderCourses();
          renderExams();
          renderStudents();
          renderAnalytics();
        }
        
        document.getElementById('loading-screen').classList.add('hidden');
      }
    };

    // Initialize SDK
    window.initAdminApp = async function() {
      try {
        // Ù†Ù†ØªØ¸Ø± Ù‚Ù„ÙŠÙ„Ø§Ù‹ Ù„Ù„ØªØ£ÙƒØ¯ Ù…Ù† ØªØ­Ù…ÙŠÙ„ dataSdk
        if (!window.dataSdk) {
           console.log("Waiting for Firebase...");
           setTimeout(window.initAdminApp, 500);
           return;
        }

        const result = await window.dataSdk.init(dataHandler);
        if (!result.isOk) {
          console.error('Failed to init SDK');
        }
        
        const savedLogin = localStorage.getItem('nour_nady_admin');
        if (savedLogin) {
          isAdminLoggedIn = true;
          showAdminDashboard();
        } else {
          showAdminLoginPage();
        }
      } catch (e) {
        console.error('Init error:', e);
        showAdminLoginPage();
      }
    }

    // Element SDK Init
    if (window.elementSdk) {
      window.elementSdk.init({
        defaultConfig,
        onConfigChange: async (config) => {
          const emailInput = document.getElementById('admin-email-input');
          const passwordInput = document.getElementById('admin-password-input');
          if (emailInput) emailInput.placeholder = config.admin_email || defaultConfig.admin_email;
          if (passwordInput) passwordInput.placeholder = config.admin_password || defaultConfig.admin_password;
        },
        mapToCapabilities: (config) => ({
          recolorables: [],
          borderables: [],
          fontEditable: undefined,
          fontSizeable: undefined
        }),
        mapToEditPanelValues: (config) => new Map([
          ['admin_email', config.admin_email || defaultConfig.admin_email],
          ['admin_password', config.admin_password || defaultConfig.admin_password]
        ])
      });
    }

    // Show Pages
    function showAdminLoginPage() {
      document.getElementById('loading-screen').classList.add('hidden');
      document.getElementById('login-page').classList.remove('hidden');
      document.getElementById('dashboard').classList.add('hidden');
    }

    function showAdminDashboard() {
      document.getElementById('loading-screen').classList.add('hidden');
      document.getElementById('login-page').classList.add('hidden');
      document.getElementById('dashboard').classList.remove('hidden');
      updateOverviewStats();
      renderCourses();
      renderExams();
      renderStudents();
      renderAnalytics();
    }

    // Handle Admin Login
    async function handleAdminLogin(e) {
      e.preventDefault();
      const email = document.getElementById('admin-email-input').value.trim();
      const password = document.getElementById('admin-password-input').value;
      const errorEl = document.getElementById('login-error');
      const btn = document.getElementById('login-btn');

      errorEl.classList.add('hidden');
      btn.disabled = true;
      btn.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚...';

      // Check credentials
      const correctEmail = window.elementSdk?.config?.admin_email || defaultConfig.admin_email;
      const correctPassword = window.elementSdk?.config?.admin_password || defaultConfig.admin_password;

      if (email === correctEmail && password === correctPassword) {
        isAdminLoggedIn = true;
        localStorage.setItem('nour_nady_admin', 'true');
        btn.disabled = false;
        btn.textContent = 'Ø¯Ø®ÙˆÙ„';
        showAdminDashboard();
      } else {
        errorEl.textContent = 'Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± ØºÙŠØ± ØµØ­ÙŠØ­Ø©';
        errorEl.classList.remove('hidden');
        btn.disabled = false;
        btn.textContent = 'Ø¯Ø®ÙˆÙ„';
      }
    }

    // Logout
    function logoutAdmin() {
      isAdminLoggedIn = false;
      localStorage.removeItem('nour_nady_admin');
      showAdminLoginPage();
    }

    // Navigation
    function showAdminSection(section) {
      const sections = ['overview', 'courses', 'exams', 'students', 'analytics'];
      sections.forEach(s => {
        const el = document.getElementById(s + '-section');
        if (el) el.classList.toggle('hidden', s !== section);
      });
      
      document.querySelectorAll('.admin-nav-btn').forEach(btn => {
        if (btn.dataset.section === section) {
          btn.classList.add('btn-primary');
          btn.classList.remove('card-glass', 'text-gray-300');
          btn.classList.add('text-white');
        } else {
          btn.classList.remove('btn-primary', 'text-white');
          btn.classList.add('card-glass', 'text-gray-300');
        }
      });
    }

    // Update Stats
    function updateOverviewStats() {
      /* DATABASE_STORAGE - Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª */
      const totalStudents = allData.filter(d => d.type === 'student').length;
      const approvedStudents = allData.filter(d => d.type === 'student' && d.status === 'approved').length;
      const totalCourses = allData.filter(d => d.type === 'course').length;
      const examGroups = new Set(allData.filter(d => d.type === 'exam').map(d => d.examId));

      document.getElementById('total-students').textContent = totalStudents;
      document.getElementById('approved-students').textContent = approvedStudents;
      document.getElementById('total-courses').textContent = totalCourses;
      document.getElementById('total-exams').textContent = examGroups.size;
    }

    // Render Courses
    function renderCourses() {
      const list = document.getElementById('courses-list');
      /* DATABASE_STORAGE - Ø¬Ù„Ø¨ Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙƒÙˆØ±Ø³Ø§Øª */
      const courses = allData.filter(d => d.type === 'course');
      
      if (courses.length === 0) {
        list.innerHTML = '<p class="text-gray-400 text-center py-10">Ù„Ø§ ØªÙˆØ¬Ø¯ ÙƒÙˆØ±Ø³Ø§Øª</p>';
        return;
      }

      list.innerHTML = courses.map(course => `
        <div class="card-glass rounded-xl p-6 flex justify-between items-center">
          <div>
            <h3 class="font-bold text-lg">${course.courseName}</h3>
            <p class="text-gray-400 text-sm">${gradeLabels[course.courseGrade] || course.courseGrade}</p>
            <p class="text-gray-500 text-sm mt-2 truncate">ÙÙŠØ¯ÙŠÙˆ: ${course.videoUrl?.substring(0, 40)}...</p>
          </div>
          <div class="flex gap-3">
            <button onclick="openEditCourseModal('${course.__backendId}')" class="btn-secondary px-4 py-2 rounded-lg text-white font-bold text-sm">ØªØ¹Ø¯ÙŠÙ„</button>
            <button onclick="confirmDeleteCourse('${course.__backendId}')" class="btn-danger px-4 py-2 rounded-lg text-white font-bold text-sm">Ø­Ø°Ù</button>
          </div>
        </div>
      `).join('');
    }

    // Open Add Course Modal
    function openAddCourseModal() {
      document.getElementById('add-course-modal').classList.remove('hidden');
    }

    function closeAddCourseModal() {
      document.getElementById('add-course-modal').classList.add('hidden');
      document.getElementById('add-course-form').reset();
    }

    // Handle Add Course
    async function handleAddCourse(e) {
      e.preventDefault();
      const name = document.getElementById('course-name-input').value.trim();
      const grade = document.getElementById('course-grade-input').value;
      const videoUrl = document.getElementById('video-url-input').value.trim();
      const btn = document.getElementById('add-course-btn');

      const courseCount = allData.filter(d => d.type === 'course').length;
      if (courseCount >= 999) {
        alert('ÙˆØµÙ„Øª Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù…Ù† Ø§Ù„ÙƒÙˆØ±Ø³Ø§Øª');
        return;
      }

      btn.disabled = true;
      btn.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø¶Ø§ÙØ©...';

      /* DATABASE_STORAGE - Ø­ÙØ¸ Ø§Ù„ÙƒÙˆØ±Ø³ Ø§Ù„Ø¬Ø¯ÙŠØ¯ */
      const result = await window.dataSdk.create({
        type: 'course',
        courseName: name,
        courseGrade: grade,
        videoUrl: videoUrl,
        createdAt: new Date().toISOString()
      });

      btn.disabled = false;
      btn.textContent = 'Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙƒÙˆØ±Ø³';

      if (result.isOk) {
        closeAddCourseModal();
      }
    }

    // Edit Course Modal
    function openEditCourseModal(courseId) {
      const course = allData.find(d => d.__backendId === courseId);
      if (!course) return;

      currentEditingCourse = course;
      document.getElementById('edit-course-name').value = course.courseName;
      document.getElementById('edit-course-grade').value = course.courseGrade;
      document.getElementById('edit-video-url').value = course.videoUrl;
      document.getElementById('edit-course-modal').classList.remove('hidden');
    }

    function closeEditCourseModal() {
      document.getElementById('edit-course-modal').classList.add('hidden');
      currentEditingCourse = null;
    }

    // Handle Edit Course
    async function handleEditCourse(e) {
      e.preventDefault();
      if (!currentEditingCourse) return;

      const name = document.getElementById('edit-course-name').value.trim();
      const grade = document.getElementById('edit-course-grade').value;
      const videoUrl = document.getElementById('edit-video-url').value.trim();
      const btn = document.getElementById('edit-course-btn');

      btn.disabled = true;
      btn.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸...';

      /* DATABASE_STORAGE - ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙƒÙˆØ±Ø³ */
      const result = await window.dataSdk.update({
        ...currentEditingCourse,
        courseName: name,
        courseGrade: grade,
        videoUrl: videoUrl
      });

      btn.disabled = false;
      btn.textContent = 'Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª';

      if (result.isOk) {
        closeEditCourseModal();
      }
    }

    // Delete Course
    async function confirmDeleteCourse(courseId) {
      if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ±Ø³ØŸ')) return;

      const course = allData.find(d => d.__backendId === courseId);
      if (!course) return;

      /* DATABASE_STORAGE - Ø­Ø°Ù Ø§Ù„ÙƒÙˆØ±Ø³ */
      await window.dataSdk.delete(course);
    }

    // Render Exams
    function renderExams() {
      const list = document.getElementById('exams-list');
      /* DATABASE_STORAGE - Ø¬Ù„Ø¨ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª */
      const exams = allData.filter(d => d.type === 'exam');
      
      if (exams.length === 0) {
        list.innerHTML = '<p class="text-gray-400 text-center py-10">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø§Ù…ØªØ­Ø§Ù†Ø§Øª</p>';
        return;
      }

      // Group by examId
      const examGroups = {};
      exams.forEach(q => {
        if (!examGroups[q.examId]) {
          examGroups[q.examId] = { name: q.courseName, grade: q.courseGrade, questions: [], firstId: q.__backendId };
        }
        examGroups[q.examId].questions.push(q);
      });

      list.innerHTML = Object.entries(examGroups).map(([examId, exam]) => `
        <div class="card-glass rounded-xl p-6 flex justify-between items-center">
          <div>
            <h3 class="font-bold text-lg">${exam.name}</h3>
            <p class="text-gray-400 text-sm">${gradeLabels[exam.grade] || exam.grade} â€¢ ${exam.questions.length} Ø£Ø³Ø¦Ù„Ø©</p>
          </div>
          <div class="flex gap-3">
            <button onclick="confirmDeleteExam('${examId}')" class="btn-danger px-4 py-2 rounded-lg text-white font-bold text-sm">Ø­Ø°Ù</button>
          </div>
        </div>
      `).join('');
    }

    // Add Exam Question
    function addExamQuestion() {
      const container = document.getElementById('exam-questions');
      const count = container.children.length + 1;
      const questionDiv = document.createElement('div');
      questionDiv.className = 'question-item p-4 card-glass rounded-lg';
      questionDiv.innerHTML = `
        <div class="mb-3">
          <label class="block mb-2 text-gray-300">Ø§Ù„Ø³Ø¤Ø§Ù„ ${count}</label>
          <input type="text" class="w-full p-3 rounded-lg input-style text-white question-text" placeholder="Ù†Øµ Ø§Ù„Ø³Ø¤Ø§Ù„" required>
        </div>
        <div class="mb-3">
          <label class="block mb-2 text-gray-300">Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª (Ù…ÙØµÙˆÙ„Ø© Ø¨ÙØ§ØµÙ„Ø©)</label>
          <input type="text" class="w-full p-3 rounded-lg input-style text-white question-options" placeholder="Ø®ÙŠØ§Ø± 1, Ø®ÙŠØ§Ø± 2, Ø®ÙŠØ§Ø± 3, Ø®ÙŠØ§Ø± 4" required>
        </div>
        <div class="mb-3">
          <label class="block mb-2 text-gray-300">Ø±Ù‚Ù… Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø© (0-3)</label>
          <input type="number" class="w-full p-3 rounded-lg input-style text-white question-correct" min="0" max="3" placeholder="0" required>
        </div>
      `;
      container.appendChild(questionDiv);
    }

    // Open Add Exam Modal
    function openAddExamModal() {
      document.getElementById('add-exam-modal').classList.remove('hidden');
      document.getElementById('exam-questions').innerHTML = `
        <div class="question-item p-4 card-glass rounded-lg">
          <div class="mb-3">
            <label class="block mb-2 text-gray-300">Ø§Ù„Ø³Ø¤Ø§Ù„ 1</label>
            <input type="text" class="w-full p-3 rounded-lg input-style text-white question-text" placeholder="Ù†Øµ Ø§Ù„Ø³Ø¤Ø§Ù„" required>
          </div>
          <div class="mb-3">
            <label class="block mb-2 text-gray-300">Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª (Ù…ÙØµÙˆÙ„Ø© Ø¨ÙØ§ØµÙ„Ø©)</label>
            <input type="text" class="w-full p-3 rounded-lg input-style text-white question-options" placeholder="Ø®ÙŠØ§Ø± 1, Ø®ÙŠØ§Ø± 2, Ø®ÙŠØ§Ø± 3, Ø®ÙŠØ§Ø± 4" required>
          </div>
          <div class="mb-3">
            <label class="block mb-2 text-gray-300">Ø±Ù‚Ù… Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø© (0-3)</label>
            <input type="number" class="w-full p-3 rounded-lg input-style text-white question-correct" min="0" max="3" placeholder="0" required>
          </div>
        </div>
      `;
    }

    function closeAddExamModal() {
      document.getElementById('add-exam-modal').classList.add('hidden');
      document.getElementById('add-exam-form').reset();
    }

    // Handle Add Exam
    async function handleAddExam(e) {
      e.preventDefault();
      const examName = document.getElementById('exam-name-input').value.trim();
      const examGrade = document.getElementById('exam-grade-input').value;
      const questions = Array.from(document.querySelectorAll('.question-item')).map(item => ({
        text: item.querySelector('.question-text').value,
        options: item.querySelector('.question-options').value.split(',').map(o => o.trim()),
        correct: item.querySelector('.question-correct').value
      }));

      const btn = document.getElementById('add-exam-btn');
      btn.disabled = true;
      btn.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡...';

      const examId = 'exam_' + Date.now();
      const questionCount = allData.filter(d => d.type === 'exam').length;

      /* DATABASE_STORAGE - Ø­ÙØ¸ Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø§Ù…ØªØ­Ø§Ù† */
      for (let q of questions) {
        if (questionCount >= 999) {
          btn.disabled = false;
          btn.textContent = 'Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†';
          alert('ÙˆØµÙ„Øª Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù…Ù† Ø§Ù„Ø£Ø³Ø¦Ù„Ø©');
          return;
        }

        await window.dataSdk.create({
          type: 'exam',
          examId: examId,
          courseName: examName,
          courseGrade: examGrade,
          questionText: q.text,
          options: JSON.stringify(q.options),
          correctAnswer: q.correct,
          createdAt: new Date().toISOString()
        });
      }

      btn.disabled = false;
      btn.textContent = 'Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†';
      closeAddExamModal();
    }

    // Delete Exam
    async function confirmDeleteExam(examId) {
      if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù† ÙˆØ¬Ù…ÙŠØ¹ Ø£Ø³Ø¦Ù„ØªÙ‡ØŸ')) return;

      /* DATABASE_STORAGE - Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø§Ù…ØªØ­Ø§Ù† */
      const questions = allData.filter(d => d.type === 'exam' && d.examId === examId);
      for (let q of questions) {
        await window.dataSdk.delete(q);
      }
    }

    // Render Students
    function renderStudents() {
      /* DATABASE_STORAGE - Ø¬Ù„Ø¨ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø§Ø¨ */
      const pendingStudents = allData.filter(d => d.type === 'student' && d.status === 'pending');
      const approvedStudents = allData.filter(d => d.type === 'student' && d.status === 'approved');

      // Pending
      const pendingList = document.getElementById('pending-students-list');
      if (pendingStudents.length === 0) {
        pendingList.innerHTML = '<p class="text-gray-400 text-center py-6">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ù…Ø¹Ù„Ù‚Ø©</p>';
      } else {
        pendingList.innerHTML = pendingStudents.map(student => `
          <div class="card-glass rounded-xl p-4 flex justify-between items-center">
            <div>
              <p class="font-bold">${student.name}</p>
              <p class="text-gray-400 text-sm">${student.phone} â€¢ ${gradeLabels[student.grade] || student.grade}</p>
            </div>
            <div class="flex gap-2">
              <button onclick="approveStudent('${student.__backendId}')" class="bg-green-500/20 text-green-400 px-3 py-2 rounded-lg hover:bg-green-500/30 font-bold text-sm">âœ“ Ù…ÙˆØ§ÙÙ‚Ø©</button>
              <button onclick="rejectStudent('${student.__backendId}')" class="btn-danger px-3 py-2 rounded-lg text-white font-bold text-sm">âœ— Ø±ÙØ¶</button>
            </div>
          </div>
        `).join('');
      }

      // Approved
      const approvedList = document.getElementById('approved-students-list');
      if (approvedStudents.length === 0) {
        approvedList.innerHTML = '<p class="text-gray-400 text-center py-6">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø§Ø¨ Ù…ÙØ¹ØªÙ…Ø¯ÙŠÙ†</p>';
      } else {
        approvedList.innerHTML = approvedStudents.map(student => `
          <div class="card-glass rounded-xl p-4 flex justify-between items-center">
            <div>
              <p class="font-bold">${student.name}</p>
              <p class="text-gray-400 text-sm">${student.phone} â€¢ ${gradeLabels[student.grade] || student.grade}</p>
            </div>
            <button onclick="removeStudent('${student.__backendId}')" class="btn-danger px-3 py-2 rounded-lg text-white font-bold text-sm">Ø¥Ø²Ø§Ù„Ø©</button>
          </div>
        `).join('');
      }
    }

    // Approve Student
    async function approveStudent(studentId) {
      const student = allData.find(d => d.__backendId === studentId);
      if (!student) return;

      /* DATABASE_STORAGE - ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ø§Ù„Ø¨ Ø¥Ù„Ù‰ Ù…Ø¹ØªÙ…Ø¯ */
      await window.dataSdk.update({ ...student, status: 'approved' });
    }

    // Reject Student
    async function rejectStudent(studentId) {
      const student = allData.find(d => d.__backendId === studentId);
      if (!student) return;

      /* DATABASE_STORAGE - ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ø§Ù„Ø¨ Ø¥Ù„Ù‰ Ù…Ø±ÙÙˆØ¶ */
      await window.dataSdk.update({ ...student, status: 'rejected' });
    }

    // Remove Student
    async function removeStudent(studentId) {
      if (!confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ø²Ø§Ù„Ø© Ù‡Ø°Ø§ Ø§Ù„Ø·Ø§Ù„Ø¨ØŸ')) return;

      const student = allData.find(d => d.__backendId === studentId);
      if (!student) return;

      /* DATABASE_STORAGE - Ø­Ø°Ù Ø§Ù„Ø·Ø§Ù„Ø¨ */
      await window.dataSdk.delete(student);
    }

    // Render Analytics
    function renderAnalytics() {
      const watchStats = document.getElementById('watch-stats');
      const examStats = document.getElementById('exam-stats');

      /* DATABASE_STORAGE - Ø¬Ù„Ø¨ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø© */
      const watches = allData.filter(d => d.type === 'watch');
      const courseWatches = {};
      watches.forEach(w => {
        if (!courseWatches[w.courseId]) courseWatches[w.courseId] = { full: 0, partial: 0 };
        if (w.watchedFull) courseWatches[w.courseId].full++;
        else courseWatches[w.courseId].partial++;
      });

      const courses = allData.filter(d => d.type === 'course');
      if (Object.keys(courseWatches).length === 0 || courses.length === 0) {
        watchStats.innerHTML = '<p class="text-gray-400 text-center py-6">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø´Ø§Ù‡Ø¯Ø©</p>';
      } else {
        watchStats.innerHTML = courses.map(course => {
          const stats = courseWatches[course.__backendId] || { full: 0, partial: 0 };
          return `
            <div class="p-3 border-l-4 border-cyan-400">
              <p class="font-bold">${course.courseName}</p>
              <p class="text-gray-400 text-sm">Ù…Ø´Ø§Ù‡Ø¯Ø© ÙƒØ§Ù…Ù„Ø©: ${stats.full} | Ù…Ø´Ø§Ù‡Ø¯Ø© Ø¬Ø²Ø¦ÙŠØ©: ${stats.partial}</p>
            </div>
          `;
        }).join('');
      }

      /* DATABASE_STORAGE - Ø¬Ù„Ø¨ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª */
      const results = allData.filter(d => d.type === 'result');
      if (results.length === 0) {
        examStats.innerHTML = '<p class="text-gray-400 text-center py-6">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ø§Ù…ØªØ­Ø§Ù†Ø§Øª</p>';
      } else {
        const examResults = {};
        results.forEach(r => {
          if (!examResults[r.examId]) {
            examResults[r.examId] = { count: 0, totalScore: 0, avg: 0 };
          }
          examResults[r.examId].count++;
          examResults[r.examId].totalScore += r.score;
        });

        Object.keys(examResults).forEach(key => {
          const exam = allData.find(d => d.type === 'exam' && d.examId === key);
          if (exam && examResults[key].count > 0) {
            examResults[key].avg = Math.round(examResults[key].totalScore / examResults[key].count);
          }
        });

        const exams = [];
        Object.entries(examResults).forEach(([id, data]) => {
          const exam = allData.find(d => d.type === 'exam' && d.examId === id);
          if (exam && !exams.find(e => e.id === id)) {
            exams.push({ id, name: exam.courseName, ...data });
          }
        });

        examStats.innerHTML = exams.map(exam => `
          <div class="p-3 border-l-4 border-purple-400">
            <p class="font-bold">${exam.name}</p>
            <p class="text-gray-400 text-sm">Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø§Ø¨: ${exam.count} | Ø§Ù„Ù…Ø¹Ø¯Ù„: ${exam.avg}%</p>
          </div>
        `).join('');
      }
    }

    // Initialize
    initAdminApp();
  </script>
</body>
</html>
